<!DOCTYPE HTML>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Spectra</title>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <style type="text/css">

    </style>
    <script type="text/javascript">
        var options = null;
        var series = [];
        var chart;
    $$(function() {
        $$.ajax("spectra.txt", {
            success: function (data) {
                var rows = data.split("\n");
                for (var row in rows) {
                    var points = rows[row].split(",");
                    var pointsFloat = [];
                    for (var idx in points) {
                        pointsFloat.push(parseFloat(points[idx]))
                    }
                    series.push(pointsFloat)
                }
            }
        })
    });
        function showSpectra(selected){
            var selectedNames =[];
            var selectedIndex =[];
            for(var opt in selected.toArray())
            {
                selectedIndex.push(selected[opt].index);
                selectedNames.push(selected[opt].text);
            }
            var chart_data = [];
            for(var idx in series)
            {
                var indexInSelected = selectedIndex.indexOf(parseInt(idx));
                if(indexInSelected != -1)
                {

                    chart_data.push(series[idx]);
                }
            }
            if !chart
            {
                chart = new Dygraph(document.getElementById("plot"), [], {
                labels: []],
                animatedZooms: true
                });
            }
            else
            {
                chart.updateOptions({"file": chart_data, "labels": selectedNames });
            }
        }

        function reloadSpectra()
        {
            console.log("reloading")
            var selected = $$('#spectra_list').find(":selected");
            showSpectra(selected);
        }
    </script>
  </head>
<body>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/heatmap.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/dygraph/1.1.1/dygraph-combined.js"></script>

      <h1>Spectra</h1>
    <form  id="spectra_list">
        <select style="height: 200px;min-width:100%" name="spectra" multiple>
                ${list}
        </select>
    </form>
   <button onclick="reloadSpectra()" style="font-size: 120%;margin: 20px;width:100px">Load</button>

    <div id="plot" style="height: 400px; min-width: 310px; margin: 0 auto"></div>
</body>
</html>
